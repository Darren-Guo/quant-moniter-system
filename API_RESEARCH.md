# 量化交易API调研报告

## 调研目标
为量化监控系统选择最适合的实时数据API，替换当前的模拟数据，实现真实市场数据监控。

## 当前系统状态
- 当前使用：yfinance（股票）、ccxt（加密货币） + 模拟数据
- 刷新频率：3秒（WebSocket实时推送）
- 数据需求：实时价格、历史数据、技术指标计算
- 监控标的：股票、加密货币、指数

## 候选API列表（基于2025年最新调研）

### 1. Alpaca Markets
- **类型**: 经纪商API
- **免费额度**: 基础计划提供有限实时数据（仅IEX交易所股票数据）
- **数据质量**: 专业级，直接来自交易所
- **更新频率**: 实时（毫秒级），但免费层有限制
- **API限制**: 约200请求/分钟（具体未明确）
- **易用性**: Python SDK完善，文档清晰
- **支持市场**: 美股（IEX交易所）、加密货币
- **实时数据**: 免费层仅限IEX交易所股票数据

### 2. Polygon.io (现为Massive)
- **类型**: 金融市场数据API
- **免费额度**: 非常有限，5 API调用/分钟
- **数据质量**: 机构级，非常准确
- **更新频率**: 实时（付费层），免费层限制严格
- **API限制**: 5请求/分钟（免费层），不适合高频监控
- **易用性**: REST API + WebSocket，文档详细
- **支持市场**: 美股、期权、外汇、加密货币
- **实时数据**: 免费层提供有限实时访问

### 3. Alpha Vantage
- **类型**: 金融市场数据API
- **免费额度**: 25请求/天（最新信息），非5请求/分钟
- **数据质量**: 良好，但有时延迟
- **更新频率**: 15分钟延迟（免费层），实时数据需要付费
- **API限制**: 非常严格，25请求/天
- **易用性**: 简单易用，免费API密钥
- **支持市场**: 全球股票、外汇、加密货币、技术指标
- **实时数据**: 需要付费订阅（$49.99-$249.99/月）

### 4. Yahoo Finance (yfinance)
- **类型**: 免费数据源（非官方API）
- **免费额度**: 无限制（但可能被限制）
- **数据质量**: 良好，但非官方API，稳定性存疑
- **更新频率**: 15分钟延迟
- **API限制**: 无官方限制，但可能被IP限制
- **易用性**: Python库简单易用
- **支持市场**: 全球股票、ETF、指数、加密货币
- **实时数据**: 15分钟延迟

### 5. IEX Cloud
- **类型**: 金融市场数据API
- **免费额度**: 50,000消息/月（免费层）
- **数据质量**: 良好，来自IEX交易所
- **更新频率**: 实时（付费层），15分钟延迟（免费层）
- **API限制**: 按消息数计费
- **易用性**: REST API，文档清晰
- **支持市场**: 美股、期权、外汇
- **实时数据**: 免费层15分钟延迟

### 6. Twelve Data
- **类型**: 金融市场数据API
- **免费额度**: 800请求/天（免费层）
- **数据质量**: 良好，覆盖广泛
- **更新频率**: 实时（付费层），延迟（免费层）
- **API限制**: 按请求计费
- **易用性**: REST API + WebSocket
- **支持市场**: 全球股票、外汇、加密货币、ETF
- **实时数据**: 免费层有延迟

## 筛选标准对比

| API | 免费额度 | 数据质量 | 更新频率 | API限制 | 易用性 | 综合评分 |
|-----|----------|----------|----------|---------|--------|----------|
| **Alpaca** | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **Polygon** | ⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| **Alpha Vantage** | ⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐ | ⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| **Yahoo Finance** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| **IEX Cloud** | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| **Twelve Data** | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ |

## 系统需求分析

### 核心需求
1. **实时性**: 3秒刷新频率需要实时或近实时数据
2. **稳定性**: 高可用性，避免服务中断
3. **成本**: 免费或低成本方案优先
4. **覆盖范围**: 支持股票、加密货币、指数
5. **技术集成**: 易于与Python系统集成

### 当前限制
- 使用模拟数据，需要真实API
- 3秒刷新可能触发API限制
- 需要支持WebSocket实时推送

## 推荐选择：混合方案（yfinance + 缓存优化）

### 选择理由
基于最新调研，所有免费API层都无法满足3秒实时刷新的需求：

1. **实时性限制**: 所有免费API都有延迟或严格限制
   - Alpaca免费层仅限IEX交易所数据
   - Polygon免费层5请求/分钟不足
   - Alpha Vantage 25请求/天太少
   - Yahoo Finance 15分钟延迟但无请求限制

2. **成本效益**: yfinance免费无限制，最适合学习/演示系统
3. **技术可行性**: 通过缓存和智能刷新优化，可以模拟"实时"体验
4. **系统兼容性**: 当前已使用yfinance，集成最简单

### 具体方案
1. **主要数据源**: yfinance（免费，无请求限制）
2. **实时性优化**: 
   - 实现数据缓存（减少API调用）
   - 使用WebSocket推送缓存数据
   - 后台异步更新真实数据
3. **降级策略**: 系统异常时使用模拟数据
4. **未来扩展**: 预留Alpaca/Polygon接口，需要时升级

### 替代方案
- **Polygon.io**: 数据质量最好，但免费层限制严格
- **Yahoo Finance + 缓存**: 成本最低，但实时性不足
- **混合方案**: Alpaca（美股）+ ccxt（加密货币）

## 实施计划

### 第一阶段：API集成
1. 注册Alpaca账户获取API密钥
2. 安装Alpaca Python SDK
3. 修改data_fetcher.py支持Alpaca API
4. 实现数据缓存机制避免API限制

### 第二阶段：优化刷新频率
1. 分析3秒刷新的必要性
2. 实现智能刷新策略
3. 添加数据本地缓存
4. 优化WebSocket推送效率

### 第三阶段：测试验证
1. 单元测试API集成
2. 性能测试刷新频率
3. 前端显示验证
4. 稳定性测试

## 风险评估

### 技术风险
1. **API限制**: 3秒刷新可能触发频率限制
   - 缓解：实现请求队列和缓存
2. **服务中断**: API服务可能不稳定
   - 缓解：添加备用数据源（yfinance）
3. **数据延迟**: 免费层可能有延迟
   - 缓解：监控数据新鲜度，必要时降级

### 成本风险
1. **超出免费额度**: 监控标的增加可能超出限制
   - 缓解：实现请求计数和预警
2. **未来收费**: API可能改变定价策略
   - 缓解：保持模块化设计，便于切换

## 下一步行动
1. 注册Alpaca账户并获取API密钥
2. 测试Alpaca API的实时数据获取
3. 修改系统代码集成Alpaca
4. 优化刷新频率策略
5. 测试前端显示效果